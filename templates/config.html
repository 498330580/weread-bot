<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…ç½®ç¼–è¾‘ - WeRead Bot</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
    <script src="https://unpkg.com/js-yaml@4.1.0/dist/js-yaml.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <h1 class="text-2xl font-bold text-indigo-600">âš™ï¸ é…ç½®ç¼–è¾‘</h1>
                <div class="flex items-center space-x-6">
                    <a href="/" class="text-gray-600 hover:text-gray-900">ğŸ›ï¸ ä¸»é¡µ</a>
                    <a href="/dashboard" class="text-gray-600 hover:text-gray-900">ğŸ“Š ä»ªè¡¨æ¿</a>
                    <a href="https://weread.yaoling.cc" target="_blank" class="text-gray-600 hover:text-gray-900" title="é¡¹ç›®æ–‡æ¡£"><i class="fab fa-wikipedia-w"></i> æ–‡æ¡£</a>
                    <a href="https://github.com/498330580/weread-bot" target="_blank" class="text-gray-600 hover:text-gray-900" title="GitHubé¡¹ç›®"><i class="fab fa-github"></i> GitHub</a>
                    <a href="https://hub.docker.com/r/498330580/weread-bot" target="_blank" class="text-gray-600 hover:text-gray-900" title="Docker Hub"><i class="fab fa-docker"></i> Docker</a>
                    <a href="/" class="text-gray-600 hover:text-gray-900">â† è¿”å›</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Quick Access Buttons -->
        <div class="mb-6 flex gap-2">
            <button onclick="toggleEditor('hide')" class="px-4 py-2 bg-indigo-100 text-indigo-600 rounded-lg hover:bg-indigo-200 text-sm font-medium">
                ğŸŒˆ ä¼šè¯æ¡†æ¨¡å¼
            </button>
            <button onclick="toggleEditor('show')" class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 text-sm font-medium">
                ğŸ“„ ä»£ç æ¨¡å¼
            </button>
        </div>

        <!-- Form Mode (Default) -->
        <div id="formModeContainer" class="block">
            <!-- Tab Navigation -->
            <div class="mb-8 bg-white rounded-lg shadow border-b">
                <div class="flex flex-wrap">
                    <button onclick="switchTab('basic')" id="tab-basic" class="px-6 py-4 border-b-2 border-indigo-600 text-indigo-600 font-medium hover:bg-gray-50">
                        âš™ï¸ åŸºç¡€é…ç½®
                    </button>
                    <button onclick="switchTab('reading')" id="tab-reading" class="px-6 py-4 border-b-2 border-transparent text-gray-600 hover:text-gray-900 font-medium hover:bg-gray-50">
                        ğŸ“– é˜…è¯»é…ç½®
                    </button>
                    <button onclick="switchTab('network')" id="tab-network" class="px-6 py-4 border-b-2 border-transparent text-gray-600 hover:text-gray-900 font-medium hover:bg-gray-50">
                        ğŸŒ ç½‘ç»œé…ç½®
                    </button>
                    <button onclick="switchTab('notification')" id="tab-notification" class="px-6 py-4 border-b-2 border-transparent text-gray-600 hover:text-gray-900 font-medium hover:bg-gray-50">
                        ğŸ”” é€šçŸ¥é…ç½®
                    </button>
                </div>
            </div>

            <!-- Tab Content Area -->
            <div class="bg-white rounded-lg shadow p-6">
                <!-- Application Configuration -->
                <div id="content-basic" class="space-y-6">
                    <div class="border-b pb-6">
                        <h3 class="text-md font-semibold text-gray-900 mb-4">ğŸ“± åº”ç”¨é…ç½®</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">å¯åŠ¨æ¨¡å¼ <span class="text-red-500">*</span></label>
                                <select id="startupMode" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    <option value="immediate">ğŸš€ ç«‹å³æ‰§è¡Œ - å¯åŠ¨åç«‹å³å¼€å§‹é˜…è¯»</option>
                                    <option value="scheduled">â° å®šæ—¶æ‰§è¡Œ - æŒ‰ç…§Cronè¡¨è¾¾å¼å®šæ—¶è¿è¡Œ</option>
                                    <option value="daemon">ğŸ”„ å®ˆæŠ¤è¿›ç¨‹ - å¾ªç¯é˜…è¯»ï¼Œä¼šè¯ä¹‹é—´æœ‰é—´éš”</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">é€‰æ‹©ç¨‹åºæ‰§è¡Œçš„å·¥ä½œæ¨¡å¼</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">å¯åŠ¨å»¶è¿Ÿï¼ˆç§’ï¼‰ <span class="text-red-500">*</span></label>
                                <input type="text" id="startupDelay" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="å¦‚ï¼š60-300" value="60-300">
                                <p class="text-xs text-gray-500 mt-1">æ”¯æŒèŒƒå›´æ ¼å¼ï¼Œé˜²æ­¢è¢«è¯†åˆ«ã€‚å»ºè®®å°½é‡è®¾ç½®å¤§ä¸€äº›</p>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-md font-semibold text-gray-900 mb-4">ğŸ“„ CURL é…ç½®</h3>
                        <div class="bg-blue-50 border border-blue-200 rounded p-4 mb-4">
                            <p class="text-sm text-blue-900">ğŸ’¡ é€‰æ‹©å•ç”¨æˆ·æˆ–å¤šç”¨æˆ·æ¨¡å¼ã€‚å¤šç”¨æˆ·æ¨¡å¼ä¼˜å…ˆçº§æ›´é«˜</p>
                        </div>
                        <div class="space-y-4">
                            <div class="border rounded p-4 bg-gray-50">
                                <label class="flex items-center mb-3">
                                    <input type="radio" name="curlMode" value="single" class="mr-2" checked>
                                    <span class="text-sm font-medium text-gray-700">å•ç”¨æˆ·æ¨¡å¼</span>
                                </label>
                                <div class="ml-6">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">CURL æ–‡ä»¶è·¯å¾„</label>
                                    <input type="text" id="curlFilePath" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed" placeholder="curl_command.txt" readonly>
                                    <p class="text-xs text-gray-500 mt-2">å•ä¸ª CURL bash å‘½ä»¤æ–‡ä»¶è·¯å¾„</p>
                                    <button type="button" onclick="openCurlEditor()" class="mt-3 px-4 py-2 bg-blue-50 text-blue-600 text-sm rounded hover:bg-blue-100">ğŸ“ ç¼–è¾‘ curl_command.txt</button>
                                </div>
                            </div>
                            <div class="border rounded p-4 bg-gray-50">
                                <label class="flex items-center mb-3">
                                    <input type="radio" name="curlMode" value="multi" class="mr-2">
                                    <span class="text-sm font-medium text-gray-700">å¤šç”¨æˆ·æ¨¡å¼</span>
                                </label>
                                <div class="ml-6 space-y-3" id="multiUserConfig" style="display: none;">
                                    <div class="text-xs text-gray-600 mb-3">æ·»åŠ å¤šä¸ªç”¨æˆ·çš„ CURL é…ç½®</div>
                                    <div id="usersList" class="space-y-3">
                                        <!-- ç”¨æˆ·åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                    <button type="button" onclick="addUserConfig()" class="px-3 py-2 bg-indigo-50 text-indigo-600 text-sm rounded hover:bg-indigo-100">+ æ·»åŠ ç”¨æˆ·</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reading Configuration -->
                <div id="content-reading" style="display:none;" class="space-y-6">
                    <div class="border-b pb-6">
                        <h3 class="text-md font-semibold text-gray-900 mb-4">ğŸ“– åŸºç¡€é˜…è¯»é…ç½®</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">é˜…è¯»æ¨¡å¼ <span class="text-red-500">*</span></label>
                                <select id="readingMode" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    <option value="smart_random">ğŸ§  æ™ºèƒ½éšæœº - å¹³è¡¡çš„ä¹¦ç±å’Œç« èŠ‚åˆ‡æ¢</option>
                                    <option value="sequential">ğŸ“š é¡ºåºé˜…è¯» - æŒ‰ç« èŠ‚é¡ºåºè¿ç»­é˜…è¯»</option>
                                    <option value="pure_random">ğŸ² çº¯éšæœº - å®Œå…¨éšæœºé€‰æ‹©ä¹¦ç±å’Œç« èŠ‚</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">æ™ºèƒ½éšæœºæ¨¡å¼æœ€ç¬¦åˆäººç±»é˜…è¯»ä¹ æƒ¯</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ç›®æ ‡é˜…è¯»æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ <span class="text-red-500">*</span></label>
                                <input type="text" id="targetDuration" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="45-90" value="45-90">
                                <p class="text-xs text-gray-500 mt-1">æ”¯æŒèŒƒå›´æ ¼å¼ã€‚å»ºè®®45-90åˆ†é’Ÿï¼Œè¿‡é•¿ä¸ç¬¦åˆé˜…è¯»ä¹ æƒ¯</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">é˜…è¯»é—´éš”ï¼ˆç§’ï¼‰ <span class="text-red-500">*</span></label>
                                <input type="text" id="readingInterval" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="30-48" value="30-48">
                                <p class="text-xs text-gray-500 mt-1">æ¯æ¬¡é˜…è¯»è¯·æ±‚ä¹‹é—´çš„å»¶è¿Ÿ</p>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="useCurlDataFirst" class="mr-2 w-4 h-4 text-indigo-600 rounded" checked>
                                <label class="text-sm text-gray-700">âœ… ä¼˜å…ˆä½¿ç”¨CURLæ•°æ®</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="fallbackToConfig" class="mr-2 w-4 h-4 text-indigo-600 rounded" checked>
                                <label class="text-sm text-gray-700">âœ… CURLæ•°æ®å¤±æ•ˆæ—¶å›é€€åˆ°é…ç½®</label>
                            </div>
                        </div>
                    </div>

                    <div class="border-b pb-6">
                        <h3 class="text-md font-semibold text-gray-900 mb-4">ğŸ§  æ™ºèƒ½éšæœºæ¨¡å¼</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ä¹¦ç±è¿ç»­æ€§ (0-1)</label>
                                <input type="range" id="bookContinuity" class="w-full" min="0" max="1" step="0.1" value="0.8">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>å€¾å‘æ¢ä¹¦</span>
                                    <span id="bookContinuityValue">0.8</span>
                                    <span>å€¾å‘ç»§ç»­</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">æ•°å€¼è¶Šé«˜è¶Šå€¾å‘äºç»§ç»­é˜…è¯»å½“å‰ä¹¦ç±</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ç« èŠ‚è¿ç»­æ€§ (0-1)</label>
                                <input type="range" id="chapterContinuity" class="w-full" min="0" max="1" step="0.1" value="0.7">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>éšæœºç« èŠ‚</span>
                                    <span id="chapterContinuityValue">0.7</span>
                                    <span>é¡ºåºç« èŠ‚</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">æ•°å€¼è¶Šé«˜è¶Šå€¾å‘äºé¡ºåºé˜…è¯»ç« èŠ‚</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ¢ä¹¦å†·å´æ—¶é—´ï¼ˆç§’ï¼‰</label>
                                <input type="number" id="bookSwitchCooldown" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" value="3600">
                                <p class="text-xs text-gray-500 mt-1">æ¢ä¹¦çš„æœ€å°é—´éš”æ—¶é—´</p>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-md font-semibold text-gray-900 mb-4">ğŸ“š ä¹¦ç±é…ç½®</h3>
                        <div class="text-xs text-gray-600 mb-3">æ·»åŠ è¦é˜…è¯»çš„ä¹¦ç±åŠå…¶ç« èŠ‚</div>
                        <div id="booksList" class="space-y-4">
                            <!-- ä¹¦ç±åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        <button type="button" onclick="addBook()" class="mt-4 px-4 py-2 bg-indigo-50 text-indigo-600 text-sm rounded hover:bg-indigo-100">+ æ·»åŠ ä¹¦ç±</button>
                    </div>
                </div>

                <!-- Human Simulation & Network Configuration -->
                <div id="content-network" style="display:none;" class="space-y-6">
                    <div class="border-b pb-6">
                        <h3 class="text-md font-semibold text-gray-900 mb-4">ğŸ­ äººç±»è¡Œä¸ºæ¨¡æ‹Ÿ</h3>
                        <div class="space-y-4">
                            <div class="flex items-center">
                                <input type="checkbox" id="humanSimulationEnabled" class="mr-2 w-4 h-4 text-indigo-600 rounded" checked>
                                <label class="text-sm text-gray-700">âœ… å¯ç”¨è¡Œä¸ºæ¨¡æ‹Ÿ</label>
                            </div>
                            <div class="ml-6 space-y-4" id="humanSimulationConfig">
                                <div class="flex items-center">
                                    <input type="checkbox" id="readingSpeedVariation" class="mr-2 w-4 h-4 text-indigo-600 rounded" checked>
                                    <label class="text-sm text-gray-700">âœ… é˜…è¯»é€Ÿåº¦å˜åŒ–</label>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ä¸­é€”ä¼‘æ¯æ¦‚ç‡ (0-1)</label>
                                    <input type="range" id="breakProbability" class="w-full" min="0" max="1" step="0.05" value="0.1">
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>ä¸ä¼‘æ¯</span>
                                        <span id="breakProbabilityValue">0.1</span>
                                        <span>ç»å¸¸ä¼‘æ¯</span>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ä¼‘æ¯æ—¶é•¿ï¼ˆç§’ï¼‰</label>
                                    <input type="text" id="breakDuration" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="5-20" value="5-20">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-md font-semibold text-gray-900 mb-4">ğŸŒ ç½‘ç»œé…ç½®</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">è¯·æ±‚è¶…æ—¶ï¼ˆç§’ï¼‰</label>
                                <input type="number" id="networkTimeout" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" value="30">
                                <p class="text-xs text-gray-500 mt-1">å•ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">é‡è¯•æ¬¡æ•°</label>
                                <input type="number" id="retryTimes" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" value="3">
                                <p class="text-xs text-gray-500 mt-1">è¯·æ±‚å¤±è´¥æ—¶çš„é‡è¯•æ¬¡æ•°</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰</label>
                                <input type="text" id="retryDelay" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="5-15" value="5-15">
                                <p class="text-xs text-gray-500 mt-1">æ”¯æŒèŒƒå›´æ ¼å¼ï¼Œé‡è¯•å‰çš„å»¶è¿Ÿæ—¶é—´</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼ˆè¯·æ±‚/åˆ†é’Ÿï¼‰</label>
                                <input type="number" id="rateLimit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" value="10">
                                <p class="text-xs text-gray-500 mt-1">é˜²æ­¢è¯·æ±‚è¿‡äºé¢‘ç¹</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notification & Schedule Configuration -->
                <div id="content-notification" style="display:none;" class="space-y-6">
                    <div class="border-b pb-6">
                        <h3 class="text-md font-semibold text-gray-900 mb-4">ğŸ”” é€šçŸ¥é…ç½®</h3>
                        <div class="space-y-4">
                            <div class="flex items-center">
                                <input type="checkbox" id="notificationEnabled" class="mr-2 w-4 h-4 text-indigo-600 rounded" checked>
                                <label class="text-sm text-gray-700">âœ… å¯ç”¨é€šçŸ¥</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="includeStatistics" class="mr-2 w-4 h-4 text-indigo-600 rounded" checked>
                                <label class="text-sm text-gray-700">âœ… åŒ…å«è¯¦ç»†ç»Ÿè®¡</label>
                            </div>
                            <div>
                                <p class="text-xs text-gray-600 mb-3">é…ç½®é€šçŸ¥é€šé“ï¼ˆæ”¯æŒå¤šä¸ªé€šé“åŒæ—¶ä½¿ç”¨ï¼‰</p>
                                <div id="notificationChannels" class="space-y-3">
                                    <!-- é€šçŸ¥é€šé“å°†åŠ¨æ€ç”Ÿæˆ -->
                                </div>
                                <button type="button" onclick="addNotificationChannel()" class="mt-4 px-4 py-2 bg-indigo-50 text-indigo-600 text-sm rounded hover:bg-indigo-100">+ æ·»åŠ é€šçŸ¥é€šé“</button>
                            </div>
                            <div class="pt-4 border-t">
                                <button type="button" onclick="testNotification()" class="px-4 py-2 bg-green-50 text-green-600 text-sm rounded hover:bg-green-100 font-medium">ğŸ§ª æµ‹è¯•é€šçŸ¥</button>
                                <p class="text-xs text-gray-500 mt-2">ç‚¹å‡»æŒ‰é’®å‘å·²å¯ç”¨çš„é€šçŸ¥é€šé“å‘é€æµ‹è¯•æ¶ˆæ¯</p>
                            </div>
                        </div>
                    </div>

                    <div class="border-b pb-6">
                        <h3 class="text-md font-semibold text-gray-900 mb-4">â° å®šæ—¶ä»»åŠ¡é…ç½®</h3>
                        <div class="bg-yellow-50 border border-yellow-200 rounded p-4 mb-4">
                            <p class="text-sm text-yellow-900">âš ï¸ ä»…åœ¨å¯åŠ¨æ¨¡å¼ä¸º"å®šæ—¶æ‰§è¡Œ"æ—¶ç”Ÿæ•ˆ</p>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center">
                                <input type="checkbox" id="scheduleEnabled" class="mr-2 w-4 h-4 text-indigo-600 rounded">
                                <label class="text-sm text-gray-700">âœ… å¯ç”¨å®šæ—¶ä»»åŠ¡</label>
                            </div>
                            <div class="ml-6 space-y-4" id="scheduleConfig" style="display: none;">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Cron è¡¨è¾¾å¼</label>
                                    <input type="text" id="cronExpression" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="0 */2 * * *" value="0 */2 * * *">
                                    <p class="text-xs text-gray-500 mt-2">ç¤ºä¾‹ï¼š</p>
                                    <ul class="text-xs text-gray-500 list-disc list-inside mt-1 space-y-1">
                                        <li>"0 */2 * * *" - æ¯2å°æ—¶æ‰§è¡Œä¸€æ¬¡</li>
                                        <li>"30 9 * * *" - æ¯å¤©9:30æ‰§è¡Œ</li>
                                        <li>"0 8,12,18 * * *" - æ¯å¤©8:00ã€12:00ã€18:00æ‰§è¡Œ</li>
                                    </ul>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">æ—¶åŒº</label>
                                    <select id="timezone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                        <option value="Asia/Shanghai">Asia/Shanghai</option>
                                        <option value="UTC">UTC</option>
                                        <option value="Asia/Hong_Kong">Asia/Hong_Kong</option>
                                        <option value="Asia/Tokyo">Asia/Tokyo</option>
                                        <option value="America/New_York">America/New_York</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-md font-semibold text-gray-900 mb-4">ğŸ”„ å®ˆæŠ¤è¿›ç¨‹é…ç½®</h3>
                        <div class="bg-yellow-50 border border-yellow-200 rounded p-4 mb-4">
                            <p class="text-sm text-yellow-900">âš ï¸ ä»…åœ¨å¯åŠ¨æ¨¡å¼ä¸º"å®ˆæŠ¤è¿›ç¨‹"æ—¶ç”Ÿæ•ˆ</p>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center">
                                <input type="checkbox" id="daemonEnabled" class="mr-2 w-4 h-4 text-indigo-600 rounded">
                                <label class="text-sm text-gray-700">âœ… å¯ç”¨å®ˆæŠ¤è¿›ç¨‹</label>
                            </div>
                            <div class="ml-6 space-y-4" id="daemonConfig" style="display: none;">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ä¼šè¯é—´éš”ï¼ˆåˆ†é’Ÿï¼‰</label>
                                    <input type="text" id="sessionInterval" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="120-180" value="120-180">
                                    <p class="text-xs text-gray-500 mt-1">æ¯ä¸ªé˜…è¯»ä¼šè¯ä¹‹é—´çš„ä¼‘æ¯æ—¶é—´</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">æ¯æ—¥æœ€å¤§ä¼šè¯æ•°</label>
                                    <input type="number" id="maxDailySessions" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" value="12">
                                    <p class="text-xs text-gray-500 mt-1">æ¯å¤©æœ€å¤šæ‰§è¡Œçš„é˜…è¯»ä¼šè¯æ¬¡æ•°</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Code Editor Mode -->
        <div id="codeModeContainer" style="display: none;">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Editor Panel -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“„ é…ç½®æ–‡ä»¶ç¼–è¾‘</h2>
                    <textarea id="configEditor" class="w-full h-96 p-4 border border-gray-300 rounded-lg font-mono text-sm"
                        placeholder="YAML é…ç½®å†…å®¹"></textarea>
                    <div class="flex gap-2 mt-4">
                        <button onclick="saveConfig()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                            ğŸ’¾ ä¿å­˜
                        </button>
                        <button onclick="downloadConfig()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            â¬‡ï¸ ä¸‹è½½
                        </button>
                        <button onclick="resetConfig()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                            â†» é‡ç½®
                        </button>
                    </div>
                </div>

                <!-- Preview Panel -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">ğŸ” é…ç½®é¢„è§ˆ</h2>
                    <div id="configPreview" class="bg-gray-50 rounded p-4 font-mono text-sm max-h-96 overflow-y-auto">
                        <p class="text-gray-600">é…ç½®é¢„è§ˆå°†åœ¨æ­¤æ˜¾ç¤º...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- CURL ç¼–è¾‘å¯¹è¯æ¡† -->
        <div id="curlEditorModal" style="display: none;" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-3/4 lg:w-2/3 max-h-96 flex flex-col">
                <div class="flex justify-between items-center mb-4 border-b pb-4">
                    <h2 class="text-lg font-semibold text-gray-900">ğŸ“ ç¼–è¾‘ CURL å‘½ä»¤</h2>
                    <button type="button" onclick="closeCurlEditor()" class="text-gray-500 hover:text-gray-700 text-2xl">âœ•</button>
                </div>
                
                <textarea id="curlContent" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg font-mono text-sm mb-4 resize-none" 
                    placeholder="è¾“å…¥CURLå‘½ä»¤..."></textarea>
                
                <div class="flex gap-2 justify-end">
                    <button type="button" onclick="closeCurlEditor()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        âœ— å–æ¶ˆ
                    </button>
                    <button type="button" onclick="saveCurlContent()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                        âœ“ ä¿å­˜
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åˆ‡æ¢ç¼–è¾‘å™¨è§†å›¾
        function toggleEditor(mode) {
            document.getElementById('formModeContainer').style.display = mode === 'hide' ? 'none' : 'block';
            document.getElementById('codeModeContainer').style.display = mode === 'show' ? 'block' : 'none';
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadConfig();
            setupEventListeners();
        });

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æ»‘å—å®æ—¶æ˜¾ç¤º
            ['bookContinuity', 'chapterContinuity', 'breakProbability'].forEach(id => {
                const elem = document.getElementById(id);
                if (elem) {
                    elem.addEventListener('input', function() {
                        document.getElementById(id + 'Value').textContent = this.value;
                    });
                }
            });

            // CURLæ¨¡å¼åˆ‡æ¢
            document.querySelectorAll('input[name="curlMode"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    document.getElementById('multiUserConfig').style.display = 
                        this.value === 'multi' ? 'block' : 'none';
                });
            });

            // å®šæ—¶ä»»åŠ¡å¯ç”¨
            document.getElementById('scheduleEnabled')?.addEventListener('change', function() {
                document.getElementById('scheduleConfig').style.display = 
                    this.checked ? 'block' : 'none';
            });

            // å®ˆæŠ¤è¿›ç¨‹å¯ç”¨
            document.getElementById('daemonEnabled')?.addEventListener('change', function() {
                document.getElementById('daemonConfig').style.display = 
                    this.checked ? 'block' : 'none';
            });

            // äººç±»è¡Œä¸ºæ¨¡æ‹Ÿå¯ç”¨
            document.getElementById('humanSimulationEnabled')?.addEventListener('change', function() {
                document.getElementById('humanSimulationConfig').style.display = 
                    this.checked ? 'block' : 'none';
            });

            // è¡¨å•å˜åŒ–æ—¶æ›´æ–°YAMLç¼–è¾‘å™¨
            document.querySelectorAll('input, select, textarea').forEach(elem => {
                elem.addEventListener('change', () => {
                    const config = collectFormConfig();
                    document.getElementById('configEditor').value = jsyaml.dump(config);
                    updatePreview();
                });
            });

            // ç¼–è¾‘å™¨è¾“å…¥æ—¶æ›´æ–°é¢„è§ˆ
            document.getElementById('configEditor').addEventListener('input', updatePreview);
        }

        // åŠ è½½é…ç½®
        async function loadConfig() {
            try {
                const response = await axios.get('/api/config');
                const config = response.data.data;
                
                fillForm(config);
                document.getElementById('configEditor').value = jsyaml.dump(config);
                updatePreview();
            } catch (error) {
                console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                alert('åŠ è½½é…ç½®å¤±è´¥: ' + error.message);
            }
        }

        // å¡«å……è¡¨å•
        function fillForm(config) {
            try {
                // åŸºç¡€é…ç½®
                document.getElementById('startupMode').value = config.app?.startup_mode || 'immediate';
                document.getElementById('startupDelay').value = config.app?.startup_delay || '60-300';

                // CURLé…ç½®
                const hasUsers = config.curl_config?.users && config.curl_config.users.length > 0;
                document.querySelector('input[name="curlMode"][value="' + (hasUsers ? 'multi' : 'single') + '"]').checked = true;
                document.getElementById('curlFilePath').value = config.curl_config?.file_path || '';
                if (hasUsers) {
                    document.getElementById('multiUserConfig').style.display = 'block';
                    renderUsersList(config.curl_config.users);
                }

                // é˜…è¯»é…ç½®
                document.getElementById('readingMode').value = config.reading?.mode || 'smart_random';
                document.getElementById('targetDuration').value = config.reading?.target_duration || '45-90';
                document.getElementById('readingInterval').value = config.reading?.reading_interval || '30-48';
                document.getElementById('useCurlDataFirst').checked = config.reading?.use_curl_data_first !== false;
                document.getElementById('fallbackToConfig').checked = config.reading?.fallback_to_config !== false;

                // æ™ºèƒ½éšæœºé…ç½®
                const sr = config.reading?.smart_random || {};
                document.getElementById('bookContinuity').value = sr.book_continuity || 0.8;
                document.getElementById('bookContinuityValue').textContent = sr.book_continuity || 0.8;
                document.getElementById('chapterContinuity').value = sr.chapter_continuity || 0.7;
                document.getElementById('chapterContinuityValue').textContent = sr.chapter_continuity || 0.7;
                document.getElementById('bookSwitchCooldown').value = sr.book_switch_cooldown || 3600;

                // ä¹¦ç±åˆ—è¡¨
                renderBooksList(config.reading?.books || []);

                // äººç±»è¡Œä¸ºæ¨¡æ‹Ÿ
                const hs = config.human_simulation || {};
                document.getElementById('humanSimulationEnabled').checked = hs.enabled !== false;
                document.getElementById('humanSimulationConfig').style.display = hs.enabled !== false ? 'block' : 'none';
                document.getElementById('readingSpeedVariation').checked = hs.reading_speed_variation !== false;
                document.getElementById('breakProbability').value = hs.break_probability || 0.1;
                document.getElementById('breakProbabilityValue').textContent = hs.break_probability || 0.1;
                document.getElementById('breakDuration').value = hs.break_duration || '5-20';

                // ç½‘ç»œé…ç½®
                document.getElementById('networkTimeout').value = config.network?.timeout || 30;
                document.getElementById('retryTimes').value = config.network?.retry_times || 3;
                document.getElementById('retryDelay').value = config.network?.retry_delay || '5-15';
                document.getElementById('rateLimit').value = config.network?.rate_limit || 10;

                // é€šçŸ¥é…ç½®
                document.getElementById('notificationEnabled').checked = config.notification?.enabled !== false;
                document.getElementById('includeStatistics').checked = config.notification?.include_statistics !== false;
                renderNotificationChannels(config.notification?.channels || []);

                // å®šæ—¶ä»»åŠ¡é…ç½®
                const sch = config.schedule || {};
                document.getElementById('scheduleEnabled').checked = sch.enabled || false;
                document.getElementById('scheduleConfig').style.display = sch.enabled ? 'block' : 'none';
                document.getElementById('cronExpression').value = sch.cron_expression || '0 */2 * * *';
                document.getElementById('timezone').value = sch.timezone || 'Asia/Shanghai';

                // å®ˆæŠ¤è¿›ç¨‹é…ç½®
                const dm = config.daemon || {};
                document.getElementById('daemonEnabled').checked = dm.enabled || false;
                document.getElementById('daemonConfig').style.display = dm.enabled ? 'block' : 'none';
                document.getElementById('sessionInterval').value = dm.session_interval || '120-180';
                document.getElementById('maxDailySessions').value = dm.max_daily_sessions || 12;
            } catch (error) {
                console.error('å¡«å……è¡¨å•å¤±è´¥:', error);
            }
        }

        // æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨
        function renderUsersList(users) {
            const list = document.getElementById('usersList');
            list.innerHTML = '';
            users.forEach((user, index) => {
                const div = document.createElement('div');
                div.className = 'border rounded p-3 bg-white';
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <input type="text" value="${user.name}" placeholder="ç”¨æˆ·å" class="flex-1 px-2 py-1 border rounded text-sm mr-2" data-user-name="${index}">
                        <button type="button" onclick="removeUser(${index})" class="px-2 py-1 bg-red-100 text-red-600 text-sm rounded hover:bg-red-200">åˆ é™¤</button>
                    </div>
                    <input type="text" value="${user.file_path}" placeholder="æ–‡ä»¶è·¯å¾„" class="w-full px-2 py-1 border rounded text-sm" data-user-file="${index}">
                `;
                list.appendChild(div);
            });
        }

        // æ·»åŠ ç”¨æˆ·
        function addUserConfig() {
            const list = document.getElementById('usersList');
            const index = list.children.length;
            const div = document.createElement('div');
            div.className = 'border rounded p-3 bg-white';
            div.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <input type="text" placeholder="æ–°ç”¨æˆ·" class="flex-1 px-2 py-1 border rounded text-sm mr-2" data-user-name="${index}">
                    <button type="button" onclick="removeUser(${index})" class="px-2 py-1 bg-red-100 text-red-600 text-sm rounded hover:bg-red-200">åˆ é™¤</button>
                </div>
                <input type="text" placeholder="curlæ–‡ä»¶è·¯å¾„" class="w-full px-2 py-1 border rounded text-sm" data-user-file="${index}">
            `;
            list.appendChild(div);
        }

        function removeUser(index) {
            document.querySelectorAll('input[data-user-name="' + index + '"]')[0]?.parentElement.parentElement.remove();
        }

        // æ¸²æŸ“ä¹¦ç±åˆ—è¡¨
        function renderBooksList(books) {
            const list = document.getElementById('booksList');
            list.innerHTML = '';
            books.forEach((book, index) => {
                const div = document.createElement('div');
                div.className = 'border rounded p-4 bg-gray-50';
                div.innerHTML = `
                    <div class="flex justify-between mb-3">
                        <input type="text" value="${book.name}" placeholder="ä¹¦ç±åç§°" class="flex-1 px-3 py-2 border rounded text-sm mr-2" data-book-name="${index}">
                        <button type="button" onclick="removeBook(${index})" class="px-3 py-2 bg-red-100 text-red-600 text-sm rounded hover:bg-red-200">åˆ é™¤</button>
                    </div>
                    <input type="text" value="${book.book_id}" placeholder="ä¹¦ç±ID" class="w-full px-3 py-2 border rounded text-sm mb-3" data-book-id="${index}">
                    <div class="text-xs text-gray-600">ç« èŠ‚ï¼ˆç”¨é€—å·åˆ†éš”ç« èŠ‚IDï¼‰</div>
                    <textarea class="w-full px-3 py-2 border rounded text-sm mt-1" rows="3" data-book-chapters="${index}" placeholder="chapter_id1, chapter_id2, ..."></textarea>
                `;
                list.appendChild(div);
            });
        }

        function addBook() {
            const list = document.getElementById('booksList');
            const index = list.children.length;
            const div = document.createElement('div');
            div.className = 'border rounded p-4 bg-gray-50';
            div.innerHTML = `
                <div class="flex justify-between mb-3">
                    <input type="text" placeholder="æ–°ä¹¦ç±" class="flex-1 px-3 py-2 border rounded text-sm mr-2" data-book-name="${index}">
                    <button type="button" onclick="removeBook(${index})" class="px-3 py-2 bg-red-100 text-red-600 text-sm rounded hover:bg-red-200">åˆ é™¤</button>
                </div>
                <input type="text" placeholder="ä¹¦ç±ID" class="w-full px-3 py-2 border rounded text-sm mb-3" data-book-id="${index}">
                <div class="text-xs text-gray-600">ç« èŠ‚ï¼ˆç”¨é€—å·åˆ†éš”ç« èŠ‚IDï¼‰</div>
                <textarea class="w-full px-3 py-2 border rounded text-sm mt-1" rows="3" data-book-chapters="${index}" placeholder="chapter_id1, chapter_id2, ..."></textarea>
            `;
            list.appendChild(div);
        }

        function removeBook(index) {
            document.querySelectorAll('input[data-book-name="' + index + '"]')[0]?.parentElement.parentElement.remove();
        }

        // æ¸²æŸ“é€šçŸ¥é€šé“
        function renderNotificationChannels(channels) {
            const list = document.getElementById('notificationChannels');
            list.innerHTML = '';
            
            // é€šçŸ¥é€šé“é…ç½®å®šä¹‰
            const channelConfigs = {
                pushplus: {
                    label: 'PushPlus',
                    fields: [{ name: 'token', label: 'Token', type: 'text', placeholder: 'ä½ çš„PushPlus Token' }]
                },
                telegram: {
                    label: 'Telegram',
                    fields: [
                        { name: 'bot_token', label: 'Bot Token', type: 'text', placeholder: 'ä½ çš„Telegram Bot Token' },
                        { name: 'chat_id', label: 'Chat ID', type: 'text', placeholder: 'ä½ çš„Telegram Chat ID' }
                    ]
                },
                wxpusher: {
                    label: 'WxPusher',
                    fields: [{ name: 'spt', label: 'SPT', type: 'text', placeholder: 'ä½ çš„WxPusher SPT' }]
                },
                apprise: {
                    label: 'Apprise',
                    fields: [{ name: 'url', label: 'Apprise URL', type: 'text', placeholder: 'discord://webhook_id/webhook_token' }]
                },
                bark: {
                    label: 'Bark',
                    fields: [
                        { name: 'server', label: 'æœåŠ¡å™¨åœ°å€', type: 'text', placeholder: 'https://api.day.app', value: 'https://api.day.app' },
                        { name: 'device_key', label: 'è®¾å¤‡Key', type: 'text', placeholder: 'ä½ çš„Barkè®¾å¤‡Key' },
                        { name: 'sound', label: 'é€šçŸ¥éŸ³æ•ˆ', type: 'text', placeholder: 'default' }
                    ]
                },
                ntfy: {
                    label: 'Ntfy',
                    fields: [
                        { name: 'server', label: 'æœåŠ¡å™¨åœ°å€', type: 'text', placeholder: 'https://ntfy.sh', value: 'https://ntfy.sh' },
                        { name: 'topic', label: 'ä¸»é¢˜åç§°', type: 'text', placeholder: 'ä½ çš„Ntfyä¸»é¢˜' },
                        { name: 'token', label: 'è®¿é—®ä»¤ç‰Œï¼ˆå¯é€‰ï¼‰', type: 'text', placeholder: 'ç”¨äºç§æœ‰ä¸»é¢˜' }
                    ]
                },
                feishu: {
                    label: 'é£ä¹¦',
                    fields: [{ name: 'webhook_url', label: 'Webhook URL', type: 'text', placeholder: 'https://open.feishu.cn/open-apis/bot/v2/hook/...' }]
                },
                wework: {
                    label: 'ä¼ä¸šå¾®ä¿¡',
                    fields: [{ name: 'webhook_url', label: 'Webhook URL', type: 'text', placeholder: 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=...' }]
                },
                dingtalk: {
                    label: 'é’‰é’‰',
                    fields: [{ name: 'webhook_url', label: 'Webhook URL', type: 'text', placeholder: 'https://oapi.dingtalk.com/robot/send?access_token=...' }]
                },
                gotify: {
                    label: 'Gotify',
                    fields: [
                        { name: 'server', label: 'æœåŠ¡å™¨åœ°å€', type: 'text', placeholder: 'https://gotify.example.com' },
                        { name: 'token', label: 'åº”ç”¨ä»¤ç‰Œ', type: 'text', placeholder: 'ä½ çš„Gotify Token' },
                        { name: 'priority', label: 'ä¼˜å…ˆçº§ï¼ˆ1-10ï¼‰', type: 'number', placeholder: '5', value: '5' }
                    ]
                },
                serverchan3: {
                    label: 'Serveré…±Â³',
                    fields: [
                        { name: 'uid', label: 'UID', type: 'text', placeholder: 'ä½ çš„Serveré…±Â³ UID' },
                        { name: 'sendkey', label: 'SendKey', type: 'text', placeholder: 'ä½ çš„Serveré…±Â³ SendKey' },
                        { name: 'tags', label: 'æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰', type: 'text', placeholder: 'é˜…è¯»æŠ¥å‘Š' }
                    ]
                },
                pushdeer: {
                    label: 'PushDeer',
                    fields: [{ name: 'pushkey', label: 'PushKey', type: 'text', placeholder: 'ä½ çš„PushDeer PushKey' }]
                }
            };
            
            Object.keys(channelConfigs).forEach(name => {
                const channelConfig = channelConfigs[name];
                const channel = channels.find(c => c.name === name) || { name, enabled: false, config: {} };
                const div = document.createElement('div');
                div.className = 'border rounded p-4 bg-gray-50 mb-4';
                
                let html = `
                    <label class="flex items-center mb-4">
                        <input type="checkbox" ${channel.enabled ? 'checked' : ''} class="mr-2 w-4 h-4" data-channel="${name}">
                        <span class="text-sm font-medium text-gray-700">${channelConfig.label}</span>
                    </label>
                    <div class="ml-6 space-y-3" data-channel-fields="${name}" style="display: ${channel.enabled ? 'block' : 'none'};">
                `;
                
                channelConfig.fields.forEach(field => {
                    const value = channel.config[field.name] || field.value || '';
                    html += `
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">${field.label}</label>
                            <input type="${field.type}" value="${value}" placeholder="${field.placeholder}" class="w-full px-2 py-1 border rounded text-sm" data-channel-config="${name}" data-config-field="${field.name}">
                        </div>
                    `;
                });
                
                html += `
                    </div>
                `;
                
                div.innerHTML = html;
                list.appendChild(div);
                
                // æ·»åŠ é€šé“å¯ç”¨/ç¦ç”¨äº‹ä»¶ç›‘å¬
                const checkbox = div.querySelector(`input[data-channel="${name}"]`);
                const fieldsDiv = div.querySelector(`[data-channel-fields="${name}"]`);
                checkbox.addEventListener('change', function() {
                    fieldsDiv.style.display = this.checked ? 'block' : 'none';
                });
            });
        }

        function addNotificationChannel() {
            // é€šçŸ¥é€šé“é€šè¿‡å¤é€‰æ¡†ç®¡ç†
            alert('è¯·åœ¨é€šçŸ¥é…ç½®ä¸­å¯ç”¨ç›¸åº”çš„é€šçŸ¥é€šé“');
        }

        // ä»è¡¨å•æ”¶é›†é…ç½®
        function collectFormConfig() {
            const config = {
                app: {
                    startup_mode: document.getElementById('startupMode').value || 'immediate',
                    startup_delay: document.getElementById('startupDelay').value || '60-300'
                },
                curl_config: {
                    file_path: document.getElementById('curlFilePath').value || 'curl_command.txt',
                    users: []
                },
                reading: {
                    mode: document.getElementById('readingMode').value || 'smart_random',
                    target_duration: document.getElementById('targetDuration').value || '45-90',
                    reading_interval: document.getElementById('readingInterval').value || '30-48',
                    use_curl_data_first: document.getElementById('useCurlDataFirst').checked,
                    fallback_to_config: document.getElementById('fallbackToConfig').checked,
                    books: [],
                    smart_random: {
                        book_continuity: parseFloat(document.getElementById('bookContinuity').value) || 0.8,
                        chapter_continuity: parseFloat(document.getElementById('chapterContinuity').value) || 0.7,
                        book_switch_cooldown: parseInt(document.getElementById('bookSwitchCooldown').value) || 3600
                    }
                },
                human_simulation: {
                    enabled: document.getElementById('humanSimulationEnabled').checked,
                    reading_speed_variation: document.getElementById('readingSpeedVariation').checked,
                    break_probability: parseFloat(document.getElementById('breakProbability').value) || 0.1,
                    break_duration: document.getElementById('breakDuration').value || '5-20'
                },
                network: {
                    timeout: parseInt(document.getElementById('networkTimeout').value) || 30,
                    retry_times: parseInt(document.getElementById('retryTimes').value) || 3,
                    retry_delay: document.getElementById('retryDelay').value || '5-15',
                    rate_limit: parseInt(document.getElementById('rateLimit').value) || 10
                },
                notification: {
                    enabled: document.getElementById('notificationEnabled').checked,
                    include_statistics: document.getElementById('includeStatistics').checked,
                    channels: (() => {
                        const channels = [];
                        document.querySelectorAll('input[data-channel]').forEach(checkbox => {
                            const channelName = checkbox.getAttribute('data-channel');
                            const enabled = checkbox.checked;
                            const config = {};
                            
                            // æ”¶é›†è¯¥é€šé“çš„æ‰€æœ‰é…ç½®å­—æ®µ
                            document.querySelectorAll(`input[data-channel-config="${channelName}"]`).forEach(input => {
                                const fieldName = input.getAttribute('data-config-field');
                                const value = input.value.trim();
                                if (value) {
                                    config[fieldName] = value;
                                }
                            });
                            
                            channels.push({
                                name: channelName,
                                enabled: enabled,
                                config: config
                            });
                        });
                        return channels;
                    })()
                },
                schedule: {
                    enabled: document.getElementById('scheduleEnabled').checked,
                    cron_expression: document.getElementById('cronExpression').value || '0 */2 * * *',
                    timezone: document.getElementById('timezone').value || 'Asia/Shanghai'
                },
                daemon: {
                    enabled: document.getElementById('daemonEnabled').checked,
                    session_interval: document.getElementById('sessionInterval').value || '120-180',
                    max_daily_sessions: parseInt(document.getElementById('maxDailySessions').value) || 12
                }
            };

            return config;
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            try {
                const editorContent = document.getElementById('configEditor').value;
                const config = jsyaml.load(editorContent);
                
                const preview = document.getElementById('configPreview');
                preview.textContent = jsyaml.dump(config, { lineWidth: 50 });
            } catch (error) {
                const preview = document.getElementById('configPreview');
                preview.innerHTML = '<span class="text-red-600">YAMLæ ¼å¼é”™è¯¯: ' + error.message + '</span>';
            }
        }

        // ä¿å­˜é…ç½®
        async function saveConfig() {
            try {
                const editorContent = document.getElementById('configEditor').value;
                const config = jsyaml.load(editorContent);
                
                const response = await axios.post('/api/config', config);
                alert('âœ… é…ç½®å·²ä¿å­˜');
                loadConfig();
            } catch (error) {
                alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }

        // ä¸‹è½½é…ç½®
        function downloadConfig() {
            window.location.href = '/api/export/config';
        }

        // é‡ç½®é…ç½®
        function resetConfig() {
            if (!confirm('ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤é…ç½®å—ï¼Ÿ')) return;
            loadConfig();
        }

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            document.querySelectorAll('[id^="content-"]').forEach(el => {
                el.style.display = 'none';
            });
            document.querySelectorAll('[id^="tab-"]').forEach(el => {
                el.classList.remove('border-indigo-600', 'text-indigo-600');
                el.classList.add('border-transparent', 'text-gray-600');
            });

            document.getElementById('content-' + tabName).style.display = 'block';
            document.getElementById('tab-' + tabName).classList.add('border-indigo-600', 'text-indigo-600');
            document.getElementById('tab-' + tabName).classList.remove('border-transparent', 'text-gray-600');
        }

        // æ‰“å¼€CURLç¼–è¾‘å¯¹è¯æ¡†
        function openCurlEditor() {
            document.getElementById('curlEditorModal').style.display = 'flex';
            // å°è¯•åŠ è½½ç°æœ‰çš„curl_command.txtå†…å®¹
            loadCurlContent();
        }

        // å…³é—­CURLç¼–è¾‘å¯¹è¯æ¡†
        function closeCurlEditor() {
            document.getElementById('curlEditorModal').style.display = 'none';
        }

        // åŠ è½½CURLæ–‡ä»¶å†…å®¹
        async function loadCurlContent() {
            try {
                const response = await axios.get('/api/curl/load');
                if (response.data.success) {
                    document.getElementById('curlContent').value = response.data.content || '';
                }
            } catch (error) {
                console.error('åŠ è½½CURLå†…å®¹å¤±è´¥:', error);
                document.getElementById('curlContent').value = '';
            }
        }

        // ä¿å­˜CURLå†…å®¹
        async function saveCurlContent() {
            try {
                const content = document.getElementById('curlContent').value;
                const filename = document.getElementById('curlFilePath').value || 'curl_command.txt';
                
                const response = await axios.post('/api/curl/save', {
                    content: content,
                    filename: filename
                });

                if (response.data.success) {
                    alert('âœ… ' + response.data.message);
                    closeCurlEditor();
                } else {
                    alert('âŒ ä¿å­˜å¤±è´¥: ' + response.data.error);
                }
            } catch (error) {
                alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }

        // ç‚¹å‡»å¯¹è¯æ¡†å¤–å…³é—­
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('curlEditorModal');
            if (event.target === modal) {
                closeCurlEditor();
            }
        });

        // æµ‹è¯•é€šçŸ¥
        async function testNotification() {
            let btn;
            try {
                // æ”¶é›†å½“å‰å·²å¯ç”¨çš„é€šçŸ¥é€šé“
                const enabledChannels = [];
                document.querySelectorAll('input[data-channel]:checked').forEach(checkbox => {
                    const channelName = checkbox.getAttribute('data-channel');
                    const configValue = document.querySelector(`input[data-channel-config="${channelName}"]`)?.value || '';
                    if (configValue) {
                        enabledChannels.push({
                            name: channelName,
                            config: { token: configValue }
                        });
                    }
                });

                if (enabledChannels.length === 0) {
                    alert('âš ï¸ è¯·å…ˆé…ç½®è‡³å°‘ä¸€ä¸ªé€šçŸ¥é€šé“');
                    return;
                }

                // ä¼šè¯è¡¨ç¤ºä¸­
                btn = event.target || document.querySelector('button[onclick*="testNotification"]');
                const originalText = btn?.textContent || 'ğŸ§ª æµ‹è¯•é€šçŸ¥';
                if (btn) {
                    btn.disabled = true;
                    btn.textContent = 'âš¡ æ­£åœ¨å‘é€...';
                }

                // è°ƒç”¨åç«¯APIæµ‹è¯•é€šçŸ¥
                const response = await axios.post('/api/notification/test', {
                    channels: enabledChannels,
                    title: 'æ­£æ¡é˜»å¼‹ - æµ‹è¯•é€šçŸ¥',
                    content: 'ğŸ‰ é€šçŸ¥é…ç½®æµ‹è¯•æˆåŠŸï¼\n\nè¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯ï¼Œè¡¨æ˜ä½ çš„é€šçŸ¥é€šé“å·²ç»æ­£å¸¸å·¥ä½œã€‚'
                });

                if (response.data.success) {
                    alert('âœ… æµ‹è¯•é€šçŸ¥å·²å‘é€ï¼\n\nå·²æˆåŠŸå‘é€åˆ° ' + enabledChannels.length + ' ä¸ªé€šçŸ¥é€šé“');
                } else {
                    alert('âŒ æµ‹è¯•å¤±è´¥: ' + response.data.error);
                }
            } catch (error) {
                console.error('æµ‹è¯•é€šçŸ¥é”™è¯¯:', error);
                alert('âŒ æµ‹è¯•å¤±è´¥: ' + error.message);
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.textContent = 'ğŸ§ª æµ‹è¯•é€šçŸ¥';
                }
            }
        }
    </script>
</body>
</html>
